<!DOCTYPE HTML>
<html>
  <head>
  
    <title>Engine Yard Docs: Deploy Hook API</title>
    <meta name="description" content="Learn why Engine Yard\'s managed Rails hosting, Rails deployment &amp; 24/7/365 live service is the best">
    <meta name="keywords" content="Ruby on Rails Fully-Managed Hosting, Scaling, Scaled, Cluster Slices, Cloud Computing, On-Demand Deployment, Merb, Rubinius, Open-Source Software">
    <meta http-equiv="expires" content="0">

    <!--[if IE]>
	  <script src="/javascripts/html5shiv"></script>
    <![endif]-->
    
	<link rel="stylesheet" href="/css/application.css" type="text/css" charset="utf-8" />
    
    <!--[if IE]>
	  <link rel="stylesheet" href="/css/ie.css" type="text/css" charset="utf-8" />
    <![endif]-->
    
    <!--[if lte IE 7]>
	  <link rel="stylesheet" href="/css/ie7.css" type="text/css" charset="utf-8" />
    <![endif]-->

    <script src="http://use.typekit.com/cra4agv.js"></script>
    <script>try{Typekit.load();}catch(e){}</script>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="wrapper">
          <h1 class="branding">
              <a href="http://engineyard.com/">Ruby On Rails Hosting Management: Engine Yard Platform-as-a-Service</a> <!-- CHANGE ON GO LIVE -->
          </h1>

          <ul class="utility">
            <li>866-518-YARD</li>
            <li>
              <form action="/search" method="get" class="search">
                <input type="text" name="q" id="searchbox" placeholder="search" />
                <input type="submit" value="Search" class="gsc-search-button" />
              </form>
            </li>
            <li>
			  <a href="https://login.engineyard.com/signup" class="login">Create Account</a>
            </li>
            <li>
			  <a href="https://cloud.engineyard.com" class="login">Sign In</a>
            </li>
          </ul>

          <nav> <!-- CHANGE ON GO LIVE -->
		  <ul class="navigation">
		    <li>
		      <a href="http://engineyard.com/products/appcloud"><span>Cloud Products</span></a>
		      <ul>
		        <li>
		          <a href="http://engineyard.com/products/appcloud">Engine Yard AppCloud</a>
		          <ul>
		            <li><a href="http://engineyard.com/products/appcloud/features">Features</a></li>
		            <li><a href="http://engineyard.com/products/appcloud/pricing">Pricing</a></li>
		            <li><a href="http://engineyard.com/video/17825326">Video Tour</a></li>
		          </ul>
		        </li>
		        <li>
		          <a href="http://engineyard.com/products/xcloud">Engine Yard xCloud</a>
		          <ul>
		            <li><a href="http://engineyard.com/products/xcloud/features">Features</a></li>
		            <li><a href="http://engineyard.com/products/xcloud/pricing">Pricing</a></li>
		          </ul>
		        </li>
		        <li>
		          <a href="http://engineyard.com/products/technology">Engine Yard Platform</a>
		          <ul>
		            <li><a href="http://engineyard.com/products/technology/stack">Technology Stack</a></li>
		          </ul>
		        </li>
		      </ul>
		    </li>

		    <li>
		      <a href="http://engineyard.com/support-plans"><span>Support</span></a>
		      <ul>
		        <li><a href="http://engineyard.com/support-plans">Support Plans</a></li>
		        <li><a href="http://engineyard.com/services">Professional Services</a></li>
		      </ul>
		    </li>

		    <li>
			  <a href="http://engineyard.com/university"><span>EY University</span></a>	
		    </li>

		    <li>
		      <a href="http://engineyard.com/videos"><span>Resources</span></a>
		      <ul>
		        <li><a href="http://engineyard.com/videos">Videos</a></li>
		        <li><a href="http://engineyard.com/podcasts">Podcasts</a></li>
		        <li><a href="http://engineyard.com/developer/events">Events</a></li>
		        <li><a href="http://engineyard.com/partners">Development Partners</a></li>
		        <li><a href="http://engineyard.com/developer/groups">User Groups</a></li> 
		        <li><a href="http://jobs.engineyard.com">Jobs Board</a></li>
		      </ul>
		    </li>

		    <li>
		      <a href="http://engineyard.com/open-source"><span>Open Source</span></a>
		      <ul>
		        <li><a href="http://engineyard.com/open-source">Projects</a></li>
		        <li><a href="http://engineyard.com/open-source/people">Contributors</a></li>
		      </ul>
		    </li>

		    <li>
		      <a href="http://engineyard.com/company/"><span>About</span></a>
		      <ul>
		        <li><a href="http://engineyard.com/company/">Overview</a></li>
		        <li><a href="http://engineyard.com/company/customers">Customers</a></li>
		        <li><a href="http://engineyard.com/company/team">Leadership Team</a></li>
		        <li><a href="http://engineyard.com/company/partners">Technology Partners</a></li>
		        <li><a href="http://engineyard.com/company/careers">Careers</a></li>
		        <li><a href="http://engineyard.com/company/news">News &amp; Press</a></li>
		        <li><a href="http://engineyard.com/company/contact">Contact Us</a></li>
		      </ul>
		    </li>

		    <li>
		      <a href="http://engineyard.com/blog"><span>Blog</span></a>
		    </li>
		  </ul>
		</nav>
        </div>
      </header>

      <div id="content">
        <div class="wrapper">
			<h1>Deploy Hook API</h1>

<p>Deploy hooks are plain old Ruby code. However, the engineyard gem does make some additional methods available within deploy hooks in order to simplify common tasks.</p>

<ul><li><p><code>all_releases()</code>: array of paths to the deployments on this instance, ordered from oldest to newest.</p></li>
<li><p><code>current_name()</code>: on a utility instance, the name of the utility instance. On non-utility instances, nil.</p></li>
<li><p><code>current_path()</code>: path to the current deployment. This is the deployment pointed to by the <code>current</code> symlink, so the value of <code>current_path()</code> will change after the <code>symlink</code> step is executed.</p></li>
<li><p><code>current_role()</code>: the role of the current instance. Possible values:</p>

<ul><li><code>solo</code>: the sole instance for the environment</li>
<li><code>app_master</code>: the application master</li>
<li><code>app</code>: a non-master application server</li>
<li><code>util</code>: a utility server. The <code>current_name</code> method will allow you to distinguish between different types of utility servers.</li>
</ul></li>
<li><p><code>environment()</code>: the value of the <code>RAILS_ENV</code>, <code>RACK_ENV</code>, and <code>MERB_ENV</code> environment variable.</p></li>
<li><p><code>latest_release()</code>: path to the most recent deployment.</p></li>
<li><p><code>migrate?()</code>: true if migrations are being run in this deployment, false otherwise.</p></li>
<li><p><code>node()</code>: Various information about the current instance and other instances in the environment. See <code>/etc/chef/dna.json</code> on an instance for an example of what <code>node</code> will return. If the information you require is available via some other method, it is preferable to use the other method to get it. <code>node</code> is just here as a catch-all.</p></li>
<li><p><code>previous_release(current=latest_release)</code>: path to the deployment prior to <code>current</code>. If nil, then <code>current</code> is the newest deployment.</p></li>
<li><p><code>oldest_release()</code>: path to the oldest deployment</p></li>
<li><p><code>on_app_master(&amp;block)</code>: execute <code>block</code> only on the environment's application master or single instance.</p></li>
<li><p><code>on_app_servers(&amp;block)</code>: execute <code>block</code> only on the environment's application servers (master and slaves) or single instance.</p></li>
<li><p><code>on_app_servers_and_utilities(&amp;block)</code>: execute <code>block</code> only on the environment's application servers and utility servers</p></li>
<li><p><code>on_utilities(*utility_names, &amp;block)</code>: execute <code>block</code> on utility servers whose names are included in <code>utility_names</code>. <code>utility_names</code> can be passed as an array or as multiple arguments.</p>

<ul><li>If called like <code>on_utilities() { ... }</code>, the block will be executed on all utility servers.</li>
<li><code>on_utilities("alpha") { ... }</code> executes the block on all utility servers named "alpha".</li>
<li><code>on_utilities("a", "b") { ... }</code> is equivalent to <code>on_utilities(%w[a b]) { ... }</code>.</li>
</ul></li>
<li><p><code>release_dir()</code>: path to the directory containing the deployments</p></li>
<li><p><code>release_path()</code>: path to the deployment that is currently being deployed</p></li>
<li><p><code>repo()</code>: the URL of this application's git repository.</p></li>
<li><p><code>repository_cache()</code>: the path to the local clone of this application's git repository.</p></li>
<li><p><code>revision()</code>: the SHA of the commit currently being deployed.</p></li>
<li><p><code>run(command)</code>: execute <code>command</code> as a nonprivileged user (<code>deploy</code> by default)</p></li>
<li><p><code>shared_path()</code>: path to the <code>shared</code> directory</p></li>
<li><p><code>stack()</code>: the web server stack for this environment. Possible values:</p>

<ul><li><code>nginx_mongrel</code>: Nginx web server and Mongrel application server</li>
<li><code>nginx_passenger</code>: Nginx web server and Passenger application server</li>
<li><code>nginx_unicorn</code>: Nginx web server and Unicorn application server</li>
</ul></li>
<li><p><code>sudo(command)</code>: execute <code>command</code> as root</p></li>
</ul>
		</div>
	</div>

      <div class="clear"></div> 

      <div id="footer">
        <div id="footer-content">
          <div class="page">
            <div class="grid_4">
              <p id="copyright">
                <p>   
                Running on Engine Yard: <a href="http://engineyard.com/products/appcloud">The Ruby Cloud</a> and <a href="http://github.com/github/gollum">Gollum</a><br /> <!-- CHANGE WHEN GO LIVE -->
                Ruby is the Language of the Cloud.<br />
                Copyright &copy; Engine Yard, Inc. All rights reserved.
              </p>
            </div>
            <div class="grid_2">
              <h2>Ruby Products</h2><!--CHANGE WHEN GO LIVE -->
              <ul>
                <li><a href="http://engineyard.com/products/appcloud">Engine Yard AppCloud</a></li>
                <li><a href="http://engineyard.com/products/xcloud">Engine Yard xCloud</a></li>
                <li><a href="http://engineyard.com/university/scheduled_classes">Rails 3 Training</a></li>
                <li><a href="http://engineyard.com/services">Professional Services</a></li>
              </ul>
            </div>
            <div class="grid_2">
              <h2>Customer Service</h2>  
              <ul>                       
                <li><a href="http://support.cloud.engineyard.com/">Request Support</a></li> 
                <li><a href="http://docs.engineyard.com">Documentation</a></li> 
                <li><a href="http://community.engineyard.com">Community Forums</a></li> 
                <li><a href="/products/support-policies">Support Policies</a></li>
                <li><a href="/legal/privacy">Privacy Policy</a></li>
              </ul>
            </div>
            <div class="grid_2">
              <h2>Ruby Community</h2>
              <ul>
                <li><a href="http://www.jruby.org">JRuby</a></li>
                <li><a href="http://rubini.us">Rubinius</a></li>
                <li><a href="http://www.railsinstaller.com">Rails Installer</a></li>
                <li><a href="http://jobs.engineyard.com">Ruby Jobs</a></li>
                <li><a href="http://www.railsdevelopment.com">Rails Developers</a></li>
              </ul>
            </div>
            <div class="grid_2">
              <h2>Socialize With Us</h2>
              <ul>
                <li>
					<a href="http://engineyard.com/blog" class="blog">Blog</a> <!--CHANGE WHEN LIVE-->
                </li>
                <li>
					<a href="http://twitter.com/engineyard" class="twitter trackLink">Twitter</a>
                </li>
                <li>                                                                             
					<a href="http://facebook.com/engineyard" class="facebook trackLink">Facebook</a>
                </li>
                <li>                                                                             
					<a href="http://www.linkedin.com/groups?gid=111752" class="linkedin trackLink">LinkedIn</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>           
    </div>

    <div class="hidden">
	  <script src="/javascripts/application.min.js"></script>
    </div>
  </body>
</html>