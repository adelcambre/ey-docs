<h1>Getting Started with JRuby</h1>

<h2>Before starting</h2>

<ul><li>Do note that this is in a very early stage of development. See below for known issues.</li>
<li>Your application should use Bundler 1.0.1 or later to manage gems.</li>
<li>Gemfile must include glassfish (be sure that bundler resolves the version to 1.0.3 or later).</li>
</ul><h2>Preparing an existing Rails app</h2>

<ul><li>An example snippet to your Gemfile:</li>
</ul><p><code>
source 'http://gems.engineyard.com'</code></p>

<p>if defined?(JRUBY_VERSION)
  gem 'activerecord-jdbc-adapter'
  gem 'jruby-openssl'
  gem 'jdbc-mysql', :require =&gt; false
  gem 'jdbc-sqlite3', :require =&gt; false
  gem 'glassfish'
else
  gem 'sqlite3-ruby', :require =&gt; 'sqlite3'
end
</p>

<p>or, equivalently:</p>

<p><code>
gem 'activerecord-jdbc-adapter', :platforms =&gt; :jruby
gem 'jruby-openssl', :platforms =&gt; :jruby
gem 'jdbc-mysql', :require =&gt; false, :platforms =&gt; :jruby
gem 'jdbc-sqlite3', :require =&gt; false, :platforms =&gt; :jruby
gem 'glassfish', :platforms =&gt; :jruby
gem 'sqlite3-ruby', :require =&gt; 'sqlite3', :platforms =&gt; :ruby
</code></p>

<p>Then run these commands to update your Gemfile.lock:</p>

<p><code>
rvm install jruby
rvm jruby
bundle install
glassfish .</code></p>

<p>git checkout -b jruby
git commit -a -m "Gemfile updated for jruby/glassfish"
git push origin jruby</p>

<p>rvm 1.8.7
gem install engineyard --pre --source http://gems.engineyard.com
</p>

<p>If you are not using RVM, do this in <code>$RAILS_ROOT</code> to update <code>Gemfile</code>:</p>

<p><code>
jruby -S bundle bundle install
git add Gemfile<em>
git commit -m 'Update Gemfile</em> for JRuby'
git push
</code></p>

<p>(Use branch of your choice.)</p>

<ul><li><code>config.ru</code> needs to be modified to <code>require 'bundler/setup'</code> correctly before the first use of <code>Bundler</code>, like so:</li>
</ul><p><code>
  # This file is used by Rack-based servers to start the application.
  # Find the latest bundler and get started</code></p>

<p>require 'rbconfig'
$:.unshift(Dir[RbConfig::CONFIG["libdir"] + "/ruby/gems/1.8/gems/bundler-*/lib"].sort.last)
require 'bundler/setup'</p>

<p>require ::File.expand_path('../config/environment',  <strong>FILE</strong>)
run CloudstockDemo::Application
</p>

<h2>Steps</h2>

<ul><li>Choose <strong>Quick Start</strong> from the <strong>Server Management</strong> pane on the left.</li>
<li>Click on <strong>Next</strong>.</li>
<li>Fill in the repository URI, choose the application type and version.</li>
<li>Also choose <strong>Framework Environment</strong>, <strong>JRuby</strong> as your Ruby Runtime, and <strong>Glassfish</strong> as your Web Server Stack.</li>
<li>Click on <strong>Next</strong>.</li>
<li>You may be presented with a deploy key. In this case, install the deploy key in your repository as usual, and click <strong>Next</strong>.</li>
<li>If your application is running on Rails 3, Bundler will manage gems, so simply click <strong>Next</strong>. Otherwise, add gems as necessary.</li>
<li>Click on <strong>Next</strong>.</li>
<li>Optionally add SSH key as usual.</li>
<li>Click on <strong>Next</strong>.</li>
<li>Choose your server configuration as usual, and click on <strong>Boot This Configuration</strong>.</li>
<li>Note that this brings up the instances to a running state, but the application code is not deployed. To complete the application deployment, click on "Applications" in the environment box.</li>
<li>Click on <strong>Deploy</strong> button. Note, change "HEAD" to your jruby branch if necessary. Alternately, from the console.</li>
<li><p><strong><em>NOTE:</em></strong> If you have migrations, you must run them manually via SSH:</p>

<p>  <code>ey ssh</code></p>

<pre><code>cd /data/APPNAME/current
jruby -S rake db:migrate
</code></pre>

<p>  </p></li>
<li><p>Back in the Instances tab, click on "HTTP" link to view your application.</p></li>
</ul><h2>Known Issues</h2>

<p>We are aware of these issues and working on identifying and fixing the causes.</p>

<ul><li>Booting an environment does not completely deploy the application.</li>
<li>The "rake" command is not using the correct platform. <a href="https://tickets.engineyard.com/issue/SD-3420">ticket</a></li>
<li>Only one application is allowed. [ <a class="internal absent" href="/ticket.html">https://tickets.engineyard.com/issue/PL-2939</a> ]</li>
</ul><p>Also, not referenced above:</p>

<ul><li><code>engingeyard</code> gem is not supported on JRuby. There is a dependency on <code>ruby-termios</code> gem which depends on native C extension. This appears to have problems, even with the announced C extension support on JRuby.</li>
</ul>