<h1>HOWTO Configure MySQL Server</h1>

<p>The default MySQL configuration file, <code>etc/mysql/my.cnf</code>, is managed by Chef and is completely recreated with defaults every time an instance is restarted, ie. terminated and recreated.  As such, making configuration changes there can be difficult as it requires a Chef recipe to make line edits in the configuration file after it's been generated by the standard Chef run on instance startup.</p>

<p>However, that default MySQL configuration file also contains an <code>!includedir</code> directive (see: http://dev.mysql.com/doc/refman/5.0/en/option-files.html) for <code>/etc/mysql.d/</code>.  This allows you to place files in that directory with MySQL program configuration values that will be sourced after the default values in <code>/etc/mysql/my.cnf</code> on startup (or restart) of any MySQL program.</p>

<h2>Example</h2>

<p>Let's say you want to have <code>mysqld</code> (the MySQL server program, itself) start up with a non-default value for it's <code>innodb_buffer_pool_size</code> value, in this case <code>1536M (1.5G)</code>.  Place this in a file:</p>

<p>  [mysqld]
  innodb_buffer_pool_size = 1536M</p>

<p>Then save your file read-able, or owned by the mysql system user, with a <code>.cnf</code> extension; <code>my_custom.cnf</code> is a good idea</p>

<p><strong>Option A</strong></p>

<p>Have Chef render a file to the include folder.</p>

<p><strong>Option B</strong></p>

<p>Place the file on <code>/db</code> volume (such as <code>/db/mysql.d/</code>) and then create a symlink with a <a href="deploy_hooks">deploy hook</a>.</p>

<h2>Dynamic Change</h2>

<p>Once you've got your configuration changes in place do you need to restart the MySQL server? It depends.</p>

<p>If the option you're setting is a <a href="http://dev.mysql.com/doc/refman/5.0/en/mysqld-option-tables.html">Dynamic option</a> you can simply make the configuration on the fly and avoid a restart.</p>

<p>Follow these steps to add your configuration change to the system dynamically.</p>

<ul><li>SSH into your MySQL instance.</li>
<li><p>Log into the MySQL console.</p>

<p>  <code>mysql -u root -ppassword</code></p></li>
</ul><p>Your root MySQL password is the same as your deploy user password.</p>

<ul><li><p>From the MySQL prompt type:</p>

<p>  <code>mysql&gt; SET GLOBAL &lt;varname&gt; = '&lt;varvalue&gt;';</code></p></li>
</ul><p>Where you'd enter the dynamic variable your wanting to set as <code>&lt;varname&gt;</code> and the new value as <code>&lt;varvalue&gt;</code>.</p>

<p>Read more about the <a href="http://dev.mysql.com/doc/refman/5.0/en/set-option.html">SET command</a>.</p>

<p><strong>Note</strong>:  When changing dynamic system variables like this, existing connections will not automatically detect the new values.  This is because system variable values for database sessions (connections) are set at connection time.  If you want your application connections to pick up on the new setting(s) immediately you will need to restart your mongrels so that they establish new database connections.</p>

<h2>Non-Dynamic Change</h2>

<p>If your configuration isn't dynamic (as determined above) you need to reboot MySQL.</p>

<p><code>
  /etc/init.d/mysql stop
  /etc/init.d/mysql start
</code></p>

<h2>One Caveat</h2>

<p>When you create a new instance Chef recipes are not run before MySQL is started.  So you'll need to either add the option dynamically or restart MySQL once the instance is fully started.</p>

<p>So if you clone, restart or resize an instance, make sure you keep this in mind.</p>

<p>Every other time you restart MySQL, your configuration in the <code>/etc/mysql.d/</code> folder will be used.</p>