====== Upgrading PostgreSQL ======
{{ :appcloud:rating-expert.png|}}
If you are viewing this page it's either because you have stumbled upon it or directed here.  

====== I rebuild my instance and now my database is empty help! ======

  - Don't panic! Your data is not lost but your data is not in 9.0 yet.
  - [[http://docs.engineyard.com/appcloud/guides/deployment/home#ey-web-disable|Put up a maintenance page!]]
  - [[http://docs.engineyard.com/appcloud/guides/deployment/home#ey-ssh|Login to your Database instance]] or go to the [[https://cloud.engineyard.com|Dashboard]] and SSH into your Database instance
  - Shut down postgresql 9.0
<code>
sudo /etc/init.d/postgresql-9.0 stop
</code>
5. Turn 8.3 back on
<code>
sudo eselect postgresql set 8.3
</code>
6. Start 8.3 back up
<code>
sudo /etc/init.d/postgresql-8.3 start
</code>
7. Great, now let's dump your databases so we can load them into 9.
<code>
pg_dumpall -U postgres > backup
</code>
8. Excellent, now let's stop 8.3 and start 9.0 back up and load your data.
<code>
sudo /etc/init.d/postgresql-8.3 stop
</code>
9. Now let's turn 9.0 back on
<code>
sudo eselect postgresql set 9.0
</code>
10. Now let's start 9.0
<code>
sudo /etc/init.d/postgresql-9.0 start
</code>
11. Now let's load your data
<code>
psql -U postgres < backup
</code>
12. Excellent, now login to the interactive shell and verify your data is there.  If it is you can proceed to the next step.

13. Note, you may need to restart Unicorn or Passenger in order to re-establish connections.  Re-deploying will handle this behavior and remove the maintenance page.